<!DOCTYPE html>
<html> 
  <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=7,IE=9">
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples 
      on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Map with legend</title> 

    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/js/dojo/dijit/themes/claro/claro.css"> 
    <link rel="stylesheet" href="css/esri.css">
    <style> 
      html, body { height: 97%; width: 98%; margin: 1%; }
      #rightPane{
        width:60%;
      }
      #legendPane{
        border: solid #97DCF2 1px;
      }
    </style> 

    <script>var dojoConfig = { parseOnLoad: true };</script> 
    <script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.3/"></script> 
    <script> 
      dojo.require("dijit.layout.BorderContainer");
      dojo.require("dijit.layout.ContentPane");
      dojo.require("dijit.layout.AccordionContainer");
      dojo.require("esri.map");
      dojo.require("esri.dijit.Legend");
      dojo.require("esri.layers.FeatureLayer");
      
      var map;
 
      function init() {
        map = new esri.Map("map", { 
          basemap: "topo",
          center: [-96.53, 38.374],
          zoom: 13
        });

        var rivers = new esri.layers.FeatureLayer("http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/MapServer/1", {
          mode: esri.layers.FeatureLayer.MODE_ONDEMAND,
          outFields: ["*"]
        });
        var waterbodies = new esri.layers.FeatureLayer("http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Hydrography/Watershed173811/MapServer/0", {
          mode: esri.layers.FeatureLayer.MODE_ONDEMAND,
          outFields: ["*"]
        });
        
        //add the legend
        dojo.connect(map,'onLayersAddResult',function(results){
          var layerInfo = dojo.map(results, function(layer,index){
            return {layer:layer.layer,title:layer.layer.name};
          });
          if(layerInfo.length > 0){
            var legendDijit = new esri.dijit.Legend({
              map:map,
              layerInfos:layerInfo ,
              style: "display:inline"
            },"legendDiv");
            legendDijit.startup();
          }
        });
        
        map.addLayers([waterbodies,rivers]);


        dojo.connect(map, 'onLoad', function(theMap) {
          //resize the map when the browser resizes
          dojo.connect(dijit.byId('map'), 'resize', map,map.resize);
        });
      }
 
      dojo.ready(init);
    </script> 
  </head> 
  
  <body class="claro"> 
    <div id="content" 
         data-dojo-type="dijit.layout.BorderContainer" 
         data-dojo-props="design:'headline', gutters:true" 
         style="width: 100%; height: 100%; margin: 0;"> 

      
      <div id="map" 
           data-dojo-type="dijit.layout.ContentPane" 
           data-dojo-props="region:'center'" 
           style="overflow:hidden;"> 
      </div> 


      <div id="rightPane" 
           data-dojo-type="dijit.layout.ContentPane" 
           data-dojo-props="region:'right'">

        <div data-dojo-type="dijit.layout.AccordionContainer" class="esriLegendLayer">
          <div data-dojo-type="dijit.layout.ContentPane" id="legendPane" 
               data-dojo-props="title:'Legend', selected:true">
            <div id="legendDiv"></div>
          </div>
          <div data-dojo-type="dijit.layout.ContentPane" 
               data-dojo-props="title:'Pane 2'">
            This pane could contain tools or additional content
          </div>
        </div>
      </div>

      
    </div> 
  </body> 
 
</html>
